
# vim: expandtab tabstop=2 shiftwidth=2

# if this is not an interactive shell, bail immediately
[[ ! $- == *i* ]] && return

alias vi="vim -X -T xterm-256color"
alias grep="grep --color=auto"
export LESS="-R"
if uname -a | grep -q Darwin ;
then
  # Mac settings
  alias d="ls -Gx"
  alias dir="ls -Glh"
  export LSCOLORS="gxdxcxcxbxDxDxaDaDecec"
  export GREP_COLOR="07;36"
  export PATH="/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin"
else
  # Linux settings
  alias d="ls -x --color -v"
  alias dir="ls -lh --color -v"
  export LS_COLORS="di=36:ex=31:ln=33"
  export GREP_COLORS="07;36"
fi

export ANSI_RESET="\[\033[0;0m\]"
export ANSI_BOLD="\[\033[0;1m\]"
export ANSI_BLACK_FG="\[\033[1;30m\]"
export ANSI_RED_FG="\[\033[1;31m\]"
export ANSI_GREEN_FG="\[\033[1;32m\]"
export ANSI_BROWN_FG="\[\033[1;33m\]"
export ANSI_BLUE_FG="\[\033[34;1m\]"
export ANSI_MAGENTA_FG="\[\033[35;1m\]"
export ANSI_CYAN_FG="\[\033[36;1m\]"
export ANSI_WHITE_FG="\[\033[37;1m\]"

if [ $(whoami) == root ] ;
then
  export PS1="${ANSI_RED_FG}\h${ANSI_RESET}:\w>"
else
  export PS1="${ANSI_GREEN_FG}\h${ANSI_RESET}:\w>"
fi

# don't create core files
ulimit -c 0

# don't save command history between sessions
unset HISTFILE
export HISTCONTROL="ignoredups"

if [ "${TERM:0:6}" == "screen" ] ; then
  export PROMPT_COMMAND="echo -ne '\033k${HOSTNAME%%.*}\033\\'"
else
  export PROMPT_COMMAND=""
fi
export RSYNC_RSH="ssh -o permitlocalcommand=no"

# Attempt to attach to a tmux session
if [[ "${TERM:0:6}" != "screen" ]] ;
then
  if [[ $(tmux list-sessions 2> /dev/null | grep -v attached) ]] ;
  then
    # If there's only a single detached session, automatically attach to it
    if [[ "$(tmux list-sessions | grep -v attached | wc -l | xargs)" == "1" ]] ;
    then
      exec tmux attach-session -t $(tmux list-sessions | grep -v attached | cut -f 1 -d :)
    else
      echo "Select tmux session to attach to:"
      tmux list-session | grep -v attached
      read -p "Session: " TMUX_SESSION_ID
      tmux has-session -t ${TMUX_SESSION_ID} && exec tmux attach-session -t ${TMUX_SESSION_ID}
    fi
  fi
fi
